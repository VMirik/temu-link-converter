<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 2rem; }
    input, textarea { width: 100%; margin-bottom: 1rem; padding: 0.5rem; }
    button { padding: 10px 20px; }
    code { background: #f2f2f2; padding: 5px; display: inline-block; }
  </style>
</head>
<body>
  <h1>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏</h1>
  <input type="text" id="originalUrl" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –æ–±—ã—á–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä Temu" />
  <button onclick="generateShortUrl()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
  <p id="shortLink"></p>

  <script>
    function generateShortUrl() {
      const baseUrl = window.location.origin;
      const input = document.getElementById('originalUrl').value;
      const urlObj = new URL(input);
      const letyParams = JSON.parse(localStorage.getItem('letyParams')) || {};

      const newUrl = new URL(urlObj.origin + urlObj.pathname);
      urlObj.searchParams.forEach((v, k) => newUrl.searchParams.set(k, v));
      Object.entries(letyParams).forEach(([k, v]) => {
        newUrl.searchParams.set(k, v);
      });

      const id = Date.now().toString(36);
      const map = JSON.parse(localStorage.getItem('linkMap') || '{}');
      map[id] = newUrl.toString();
      localStorage.setItem('linkMap', JSON.stringify(map));

      document.getElementById('shortLink').innerHTML = `üëâ <code>${baseUrl}/redirect.html?id=${id}</code>`;
    }
  </script>
</body>
</html>